var cc=cc=cc||{};cc.AppDelegate=cc.Application.extend({ctor:function(){this._super()},initInstance:function(){return!0},applicationDidFinishLaunching:function(){var a=cc.Director.sharedDirector();a.setDisplayFPS(!0);a.setAnimationInterval(1/60);var b=SysMenu.scene();a.runWithScene(b);return!0},applicationDidEnterBackground:function(){cc.Director.sharedDirector().pause()},applicationWillEnterForeground:function(){cc.Director.sharedDirector().resume()}});var s_bg01="Resources/bg01.jpg",s_loading="Resources/loading.png",s_ship01="Resources/ship01.png",s_menu="Resources/menu.png",s_logo="Resources/logo.png",s_cocos2dhtml5="Resources/cocos2d-html5.png",s_gameOver="Resources/gameOver.png",s_menuTitle="Resources/menuTitle.png",s_Enemy="Resources/Enemy.png",s_flare="Resources/flare.jpg",s_bullet="Resources/bullet.png",s_explosion="Resources/explosion.png",s_explode1="Resources/explode1.jpg",s_explode2="Resources/explode2.jpg",s_explode3="Resources/explode3.jpg",
s_hit="Resources/hit.jpg",s_bgMusic="Resources/Music/bgMusic",s_mainMainMusic="Resources/Music/mainMainMusic",s_buttonEffect="Resources/Music/buttonEffet",s_explodeEffect="Resources/Music/explodeEffect",s_fireEffect="Resources/Music/fireEffect",s_shipDestroyEffect="Resources/Music/shipDestroyEffect",s_level01="Resources/level01.tmx",s_Enemy_plist="Resources/Enemy.plist",s_explosion_plist="Resources/explosion.plist",s_bullet_plist="Resources/bullet.plist",g_ressources=[{type:"image",src:s_bg01},{type:"image",
src:s_ship01},{type:"image",src:s_menu},{type:"image",src:s_logo},{type:"image",src:s_cocos2dhtml5},{type:"image",src:s_gameOver},{type:"image",src:s_menuTitle},{type:"image",src:s_Enemy},{type:"image",src:s_flare},{type:"image",src:s_bullet},{type:"image",src:s_explosion},{type:"image",src:s_explode1},{type:"image",src:s_explode2},{type:"image",src:s_explode3},{type:"image",src:s_hit},{type:"tmx",src:s_level01},{type:"plist",src:s_Enemy_plist},{type:"plist",src:s_explosion_plist},{type:"plist",src:s_bullet_plist},
{type:"bgm",src:s_bgMusic},{type:"bgm",src:s_mainMainMusic},{type:"effect",src:s_buttonEffect},{type:"effect",src:s_explodeEffect},{type:"effect",src:s_fireEffect},{type:"effect",src:s_shipDestroyEffect}];var winSize=null,keys=[],global={level:1,life:4,score:0,sound:!0,DELTA_X:-100,OFFSET_X:-24,ROT:-5.625,bulletType:{Ship:1,Enemy:2},weaponType:{one:1},Tag:{EnemyBullet:900,Enemy:901,Ship:902,ShipBullet:903},moveType:{Attack:0,Vertical:1,Horizontal:2,Overlap:3},AttackMode:{Normal:1,Tsuihikidan:2},lifeUpScores:[5E4,1E5,15E4,2E5,25E4,3E5]};var Level1={enemies:[{ShowType:"Repeate",ShowTime:"00:02",Types:[0,1,2,1,3]},{ShowType:"Repeate",ShowTime:"00:08",Types:[0,4,3,5]},{ShowType:"Once",ShowTime:"00:6",Types:[0,2,4,3]},{ShowType:"Once",ShowTime:"00:16",Types:[0,2,5,4,3]},{ShowType:"Once",ShowTime:"00:25",Types:[0,3,5,4,3]},{ShowType:"Once",ShowTime:"00:35",Types:[4,5,3,1,3]},{ShowType:"Once",ShowTime:"00:50",Types:[0,3,2,1,0,3]},{ShowType:"Once",ShowTime:"01:15",Types:[4,5,2,1,0]}]};var EnemyType=[{type:0,textureName:"E0.png",bulletType:"W2.png",HP:2,moveType:global.moveType.Vertical,attackMode:global.AttackMode.Normal,scoreValue:20},{type:1,textureName:"E1.png",bulletType:"W2.png",HP:4,moveType:global.moveType.Attack,attackMode:global.AttackMode.Normal,scoreValue:40},{type:2,textureName:"E2.png",bulletType:"W2.png",HP:6,moveType:global.moveType.Horizontal,attackMode:global.AttackMode.Tsuihikidan,scoreValue:60},{type:3,textureName:"E3.png",bulletType:"W2.png",HP:8,moveType:global.moveType.Overlap,
attackMode:global.AttackMode.Normal,scoreValue:80},{type:4,textureName:"E4.png",bulletType:"W2.png",HP:15,moveType:global.moveType.Horizontal,attackMode:global.AttackMode.Tsuihikidan,scoreValue:150},{type:5,textureName:"E5.png",bulletType:"W2.png",HP:20,moveType:global.moveType.Horizontal,attackMode:global.AttackMode.Normal,scoreValue:200}];var additiveSprite=cc.Sprite.extend({draw:function(a){(a||cc.renderContext).globalCompositeOperation="lighter";this._super(a)}}),flareEffect=function(a,b,c){var d=new additiveSprite;d.initWithFile(s_flare);a.addChild(d,10);d.setOpacity(0);d.setPosition(cc.ccp(-30,297));d.setRotation(-120);d.setScale(0.2);var a=cc.FadeTo.actionWithDuration(0.5,255),e=cc.FadeTo.actionWithDuration(1,0),f=cc.ScaleBy.actionWithDuration(0.7,1.2,1.2),f=cc.EaseSineOut.actionWithAction(f),g=cc.MoveBy.actionWithDuration(0.5,
cc.ccp(328,0)),g=cc.EaseSineOut.actionWithAction(g),h=cc.RotateBy.actionWithDuration(2.5,90),h=cc.EaseExponentialOut.actionWithAction(h),i=cc.ScaleTo.actionWithDuration(0.5,1),b=cc.CallFunc.actionWithTarget(b,c),c=cc.CallFunc.actionWithTarget(d,function(){this.getParent().removeChild(this)});d.runAction(cc.Sequence.actions(a,f,e,c,b));d.runAction(g);d.runAction(h);d.runAction(i)},spark=function(a,b,c,d){var c=c||0.3,d=d||0.5,e=new additiveSprite;e.initWithFile(s_explode1);var f=new additiveSprite;
f.initWithFile(s_explode2);var g=new additiveSprite;g.initWithFile(s_explode3);e.setPosition(a);f.setPosition(a);g.setPosition(a);b.addChild(f);b.addChild(g);e.setScale(c);f.setScale(c);g.setScale(c);g.setRotation(360*Math.random());var a=cc.RotateBy.actionWithDuration(d,-45),c=cc.RotateBy.actionWithDuration(d,45),h=cc.ScaleBy.actionWithDuration(d,3,3),i=cc.FadeOut.actionWithDuration(d);e.runAction(a);f.runAction(c);e.runAction(h);f.runAction(h.copy());g.runAction(h.copy());e.runAction(i);f.runAction(i.copy());
g.runAction(i.copy());setTimeout(function(){b.removeChild(e);b.removeChild(f);b.removeChild(g)},1E3*d)};var Enemy=cc.Sprite.extend({active:!0,speed:200,bulletSpeed:-200,HP:15,bulletPowerValue:1,moveType:null,scoreValue:200,zOrder:1E3,delayTime:1+1.2*Math.random(),attackMode:global.AttackMode.Normal,_hurtColorLife:0,ctor:function(a){this.HP=a.HP;this.moveType=a.moveType;this.scoreValue=a.scoreValue;this.attackMode=a.attackMode;this.initWithSpriteFrameName(a.textureName);this.schedule(this.shoot,this.delayTime)},_timeTick:0,update:function(a){0>=this.HP&&(this.active=!1);this._timeTick+=a;0.1<this._timeTick&&
(this._timeTick=0,0<this._hurtColorLife&&this._hurtColorLife--,1==this._hurtColorLife&&this.setColor(new cc.Color3B(255,255,255)))},destroy:function(){global.score+=this.scoreValue;var a=new Explosion;a.setPosition(this.getPosition());this.getParent().addChild(a);spark(this.getPosition(),this.getParent(),1.2,0.7);this.getParent().removeChild(this);global.sound&&cc.AudioManager.sharedEngine().playEffect(s_explodeEffect)},shoot:function(){var a=new Bullet(this.bulletSpeed,"W2.png",this.attackMode);
this.getParent().addChild(a,a.zOrder,global.Tag.EnemyBullet);a.setPosition(cc.ccp(this.getPosition().x,this.getPosition().y-0.2*this.getContentSize().height))},hurt:function(){this._hurtColorLife=2;this.HP--;this.setColor(cc.RED())},collideRect:function(){var a=this.getContentSize();return new cc.RectMake(this.getPositionX()-a.width/2,this.getPositionY()-a.height/4,a.width,a.height/2)}});
Enemy.sharedEnemy=function(){cc.SpriteFrameCache.sharedSpriteFrameCache().addSpriteFramesWithFile(s_Enemy_plist,s_Enemy)};var Explosion=additiveSprite.extend({tmpWidth:0,tmpHeight:0,ctor:function(){this._super();this.tmpWidth=this.getContentSize().width;this.tmpHeight=this.getContentSize().height;this.initWithSpriteFrame(cc.SpriteFrameCache.sharedSpriteFrameCache().spriteFrameByName("explosion_01.png"));var a=cc.AnimationCache.sharedAnimationCache().animationByName("Explosion");this.runAction(cc.Sequence.actions(cc.Animate.actionWithAnimation(a,!1),cc.CallFunc.actionWithTarget(this,this.destroy)))},destroy:function(){this.getParent().removeChild(this)}});
Explosion.sharedExplosion=function(){cc.SpriteFrameCache.sharedSpriteFrameCache().addSpriteFramesWithFile(s_explosion_plist);for(var a=[],b="",c=1;35>c;c++)b="explosion_"+(10>c?"0"+c:c)+".png",b=cc.SpriteFrameCache.sharedSpriteFrameCache().spriteFrameByName(b),a.push(b);a=cc.Animation.animationWithFrames(a,0.04);cc.AnimationCache.sharedAnimationCache().addAnimation(a,"Explosion")};var Ship=cc.Sprite.extend({speed:220,bulletSpeed:700,HP:10,bulletTypeValue:1,bulletPowerValue:1,throwBombing:!1,canBeAttack:!0,isThrowingBomb:!1,zOrder:3E3,maxBulletPowerValue:4,appearPosition:cc.ccp(160,60),_hurtColorLife:0,active:!0,ctor:function(){var a=cc.TextureCache.sharedTextureCache().addImage(s_ship01);this.initWithTexture(a,cc.RectMake(0,0,60,38));this.setTag(this.zOrder);this.setPosition(this.appearPosition);var b=cc.Animation.animation();b.addFrameWithTexture(a,cc.RectMake(0,0,60,38));
b.addFrameWithTexture(a,cc.RectMake(60,0,60,38));b=cc.Animate.actionWithDuration(0.1,b,!0);this.runAction(cc.RepeatForever.actionWithAction(b));this.schedule(this.shoot,0.125);this.canBeAttack=!1;var c=new additiveSprite;c.initWithTexture(a,cc.RectMake(0,45,60,38));c.setScale(8);c.setPosition(cc.ccp(this.getContentSize().width/2,12));this.addChild(c,3E3,99999);c.runAction(cc.ScaleTo.actionWithDuration(0.5,1,1));a=cc.Blink.actionWithDuration(3,9);b=cc.CallFunc.actionWithTarget(this,function(a){a.canBeAttack=
!0;a.setIsVisible(!0);a.removeChild(c)});this.runAction(cc.Sequence.actions(cc.DelayTime.actionWithDuration(0.5),a,b));global.sound&&cc.AudioManager.sharedEngine().playBackgroundMusic(s_bgMusic,!0)},update:function(a){var b=this.getPosition().x,c=this.getPosition().y;if((keys[cc.KEY.w]||keys[cc.KEY.up])&&this.getPosition().y<=winSize.height)c+=a*this.speed;if((keys[cc.KEY.s]||keys[cc.KEY.down])&&0<=this.getPosition().y)c-=a*this.speed;if((keys[cc.KEY.a]||keys[cc.KEY.left])&&0<=this.getPosition().x)b-=
a*this.speed;if((keys[cc.KEY.d]||keys[cc.KEY.right])&&this.getPosition().x<=winSize.width)b+=a*this.speed;this.setPosition(cc.ccp(b,c));0>=this.HP&&(this.active=!1);this._timeTick+=a;0.1<this._timeTick&&(this._timeTick=0,0<this._hurtColorLife&&this._hurtColorLife--,1==this._hurtColorLife&&this.setColor(new cc.Color3B(255,255,255)))},shoot:function(){var a=new Bullet(this.bulletSpeed,"W1.png",global.AttackMode.Normal);this.getParent().addChild(a,a.zOrder,global.Tag.ShipBullet);a.setPosition(cc.ccp(this.getPosition().x+
13,this.getPosition().y+3+0.3*this.getContentSize().height));a=new Bullet(this.bulletSpeed,"W1.png",global.AttackMode.Normal);this.getParent().addChild(a,a.zOrder,global.Tag.ShipBullet);a.setPosition(cc.ccp(this.getPosition().x-13,this.getPosition().y+3+0.3*this.getContentSize().height))},destroy:function(){global.life--;this.getParent().addChild(new Explosion(this.getPosition().x,this.getPosition().y));this.getParent().removeChild(this);global.sound&&cc.AudioManager.sharedEngine().playEffect(s_shipDestroyEffect)},
hurt:function(){this.canBeAttack&&(this._hurtColorLife=2,this.HP--,this.setColor(cc.RED()))},collideRect:function(){var a=this.getContentSize();return new cc.RectMake(this.getPositionX()-a.width/2,this.getPositionY()-a.height/2,a.width,a.height/2)}});var Bullet=additiveSprite.extend({active:!0,xVolocity:0,yVolocity:200,power:1,HP:1,moveType:null,zOrder:3E3,attackMode:global.AttackMode.Normal,parentType:global.bulletType.Ship,ctor:function(a,b,c){this.yVolocity=-a;this.attackMode=c;cc.SpriteFrameCache.sharedSpriteFrameCache().addSpriteFramesWithFile(s_bullet_plist);this.initWithSpriteFrameName(b)},update:function(a){var b=this.getPositionX(),c=this.getPositionY(),b=b-this.xVolocity*a,c=c-this.yVolocity*a;this.setPosition(cc.ccp(b,c));0>=this.HP&&
(this.active=!1)},destroy:function(){var a=new additiveSprite;a.initWithFile(s_hit);a.setPosition(this.getPosition());a.setRotation(360*Math.random());a.setScale(0.75);this.getParent().addChild(a,9999);this.getParent().removeChild(this);var b=cc.CallFunc.actionWithTarget(a,a.removeFromParentAndCleanup);a.runAction(cc.ScaleBy.actionWithDuration(0.3,2,2));a.runAction(cc.Sequence.actions(cc.FadeOut.actionWithDuration(0.3),b))},hurt:function(){this.HP--},collideRect:function(){this.getContentSize();return new cc.RectMake(this.getPositionX()-
3,this.getPositionY()-3,6,6)}});var SysMenu=cc.Layer.extend({_ship:null,init:function(){var a=!1;if(this._super){winSize=cc.Director.sharedDirector().getWinSize();a=cc.Sprite.spriteWithFile(s_loading);a.setAnchorPoint(cc.PointZero());this.addChild(a,0,1);a=cc.Sprite.spriteWithFile(s_logo);a.setAnchorPoint(cc.ccp(0,0));a.setPosition(cc.ccp(0,250));this.addChild(a,10,1);var b=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(0,0,126,33)),c=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(0,33,126,33)),d=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(0,
66,126,33)),e=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(126,0,126,33)),f=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(126,33,126,33)),g=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(126,66,126,33)),a=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(252,0,126,33)),h=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(252,33,126,33)),i=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(252,66,126,33)),b=cc.MenuItemSprite.itemFromNormalSprite(b,c,d,this,function(){this.onButtonEffect();flareEffect(this,this,this.onNewGame)}),
e=cc.MenuItemSprite.itemFromNormalSprite(e,f,g,this,this.onSettings),a=cc.MenuItemSprite.itemFromNormalSprite(a,h,i,this,this.onAbout),a=cc.Menu.menuWithItems(b,e,a);a.alignItemsVerticallyWithPadding(10);this.addChild(a,1,2);a.setPosition(cc.ccp(winSize.width/2,winSize.height/2-80));this.schedule(this.update,0.1);a=cc.TextureCache.sharedTextureCache().addImage(s_ship01);this._ship=cc.Sprite.spriteWithTexture(a,cc.RectMake(0,45,60,38));this.addChild(this._ship,0,4);this._ship.setPosition(cc.ccp(Math.random()*
winSize.width,0));this._ship.runAction(cc.MoveBy.actionWithDuration(2,cc.ccp(Math.random()*winSize.width,this._ship.getPosition().y+winSize.height+100)));a=!0}return a},onNewGame:function(){var a=cc.Scene.node();a.addChild(GameLayer.node());a.addChild(GameControlMenu.node());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.transitionWithDuration(1.2,a))},onSettings:function(){this.onButtonEffect();var a=cc.Scene.node();a.addChild(SettingsLayer.node());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.transitionWithDuration(1.2,
a))},onAbout:function(){this.onButtonEffect();var a=cc.Scene.node();a.addChild(AboutLayer.node());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.transitionWithDuration(1.2,a))},update:function(){480<this._ship.getPosition().y&&(this._ship.setPosition(cc.ccp(Math.random()*winSize.width,10)),this._ship.runAction(cc.MoveBy.actionWithDuration(parseInt(5*Math.random()),cc.ccp(Math.random()*winSize.width,this._ship.getPosition().y+480))))},onButtonEffect:function(){global.sound&&cc.AudioManager.sharedEngine().playEffect(s_buttonEffect)}});
SysMenu.node=function(){var a=new SysMenu;return a&&a.init()?a:null};SysMenu.scene=function(){var a=cc.Scene.node(),b=SysMenu.node();a.addChild(b);return a};var LevelManager=cc.Class.extend({_currentLevel:null,_gameLayer:null,ctor:function(a){if(!a)throw"gameLayer must be non-nil";this._currentLevel=Level1;this._gameLayer=a;this.setLevel(this._currentLevel)},setLevel:function(a){for(var b=0;b<a.enemies.length;b++)this._currentLevel.enemies[b].ShowTime=this._minuteToSecond(this._currentLevel.enemies[b].ShowTime)},_minuteToSecond:function(a){return!a?0:"number"!=typeof a?(a=a.split(":"),1==a.length?parseInt(a[0]):60*parseInt(a[0])+parseInt(a[1])):a},loadLevelResource:function(a){for(var b=
0;b<this._currentLevel.enemies.length;b++){var c=this._currentLevel.enemies[b];if(c)if("Once"==c.ShowType){if(c.ShowTime==a)for(var d=0;d<c.Types.length;d++)this.addEnemyToGameLayer(c.Types[d])}else if("Repeate"==c.ShowType&&0==a%c.ShowTime)for(d=0;d<c.Types.length;d++)this.addEnemyToGameLayer(c.Types[d])}},addEnemyToGameLayer:function(a){a=new Enemy(EnemyType[a]);a.setPosition(cc.ccp(80+(winSize.width-160)*Math.random(),winSize.height));var b;switch(a.moveType){case global.moveType.Attack:b=this._gameLayer._ship.getPosition();
b=cc.MoveTo.actionWithDuration(1,b);break;case global.moveType.Vertical:b=cc.ccp(0,-winSize.height-a.getContentSize().height);b=cc.MoveBy.actionWithDuration(4,b);break;case global.moveType.Horizontal:b=cc.ccp(0,-100-200*Math.random());b=cc.MoveBy.actionWithDuration(0.5,b);var c=cc.MoveBy.actionWithDuration(1,cc.ccp(-50-100*Math.random(),0)),d=cc.DelayTime.actionWithDuration(1),e=cc.MoveBy.actionWithDuration(1,cc.ccp(100+100*Math.random(),0)),f=cc.CallFunc.actionWithTarget(a,function(a){a.runAction(cc.RepeatForever.actionWithAction(cc.Sequence.actions(d,
e.copy(),d,e.copy().reverse())))});b=cc.Sequence.actions(b,c,f);break;case global.moveType.Overlap:c=a.getPosition().x<=winSize.width/2?320:-320,b=cc.MoveBy.actionWithDuration(4,cc.ccp(c,-240)),c=cc.MoveBy.actionWithDuration(4,cc.ccp(-c,-320)),b=cc.Sequence.actions(b,c)}this._gameLayer.addChild(a,a.zOrder,global.Tag.Enemy);a.runAction(b)}});var GameControlMenu=cc.Layer.extend({init:function(){var a=!1;if(this._super()){cc.MenuItemFont.setFontSize(18);cc.MenuItemFont.setFontName("Arial");var a=cc.MenuItemFont.itemFromString("Main Menu",this,this.sysMenu),b=cc.Menu.menuWithItems(a,null);b.setPosition(cc.ccp(0,0));a.setAnchorPoint(cc.ccp(0,0));a.setPosition(cc.ccp(winSize.width-95,5));this.addChild(b,1,2);a=!0}return a},sysMenu:function(){var a=cc.Scene.node();a.addChild(SysMenu.node());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.transitionWithDuration(1.2,
a))}});GameControlMenu.node=function(){var a=new GameControlMenu;return a&&a.init()?a:null};var GameLayer=cc.Layer.extend({_time:null,_ship:null,_backSky:null,_backSkyHeight:0,_backSkyRe:null,_backTileMap:null,_backTileMapHeight:0,_backTileMapRe:null,_levelManager:null,_tmpScore:0,_isBackSkyReload:!1,_isBackTileReload:!1,lbScore:null,screenRect:null,explosionAnimation:[],init:function(){var a=!1;this._super()&&(Explosion.sharedExplosion(),Enemy.sharedEnemy(),this._levelManager=new LevelManager(this),this.initBackground(),this.screenRect=new cc.Rect(-20,-20,winSize.width+40,winSize.height+
40),this.lbScore=cc.LabelTTF.labelWithString("Score: 0",cc.SizeMake(winSize.width/2,50),cc.TextAlignmentRight,"Arial",14),this.addChild(this.lbScore,1E3),this.lbScore.setPosition(cc.ccp(winSize.width-100,winSize.height-15)),a=cc.TextureCache.sharedTextureCache().addImage(s_ship01),a=cc.Sprite.spriteWithTexture(a,cc.RectMake(0,0,60,38)),a.setScale(0.6),a.setPosition(cc.ccp(30,460)),this.addChild(a,1,5),this._lbLife=cc.LabelTTF.labelWithString("0","Arial",20),this._lbLife.setPosition(cc.ccp(60,463)),
this._lbLife.setColor(cc.RED()),this.addChild(this._lbLife,1E3),this._ship=new Ship,this.addChild(this._ship,this._ship.zOrder,global.Tag.Ship),this.setIsTouchEnabled(!0),this.setIsKeypadEnabled(!0),this.schedule(this.update),this.schedule(this.checkEnemyAndBulletIsInBound,5),this.schedule(this.timeCounter,1),a=!0);return a},timeCounter:function(){this._time++;this._levelManager.loadLevelResource(this._time)},ccTouchesEnded:function(a){0>=a.length||(a=a[0],a.locationInView(a.view()))},keyDown:function(a){keys[a]=
!0},keyUp:function(a){keys[a]=!1},update:function(a){this.checkIsCollide();this.removeInactiveUnit(a);this.checkIsReborn();this.updateUI()},checkIsCollide:function(){for(var a,b,c=this.getChildren(),d=0;d<c.length;d++)if(a=c[d],a.getTag()==global.Tag.Enemy){for(var e=0;e<c.length;e++)b=c[e],b.getTag()==global.Tag.ShipBullet&&this.collide(a,b)&&(b.hurt(),a.hurt());this.collide(a,this._ship)&&this._ship.active&&(a.hurt(),this._ship.hurt())}else a.getTag()==global.Tag.EnemyBullet&&(this.collide(a,this._ship)&&
this._ship.active)&&(a.hurt(),this._ship.hurt())},removeInactiveUnit:function(a){var b,c=this.getChildren(),d;for(d in c)if(b=c[d])b.update(a),(b.getTag()==global.Tag.Ship||b.getTag()==global.Tag.ShipBullet||b.getTag()==global.Tag.Enemy||b.getTag()==global.Tag.EnemyBullet)&&b&&!b.active&&b.destroy()},checkIsReborn:function(){0<global.life&&!this._ship.active?(this._ship=new Ship,this.addChild(this._ship,this._ship.zOrder,global.Tag.Ship)):0>=global.life&&!this._ship.active&&this.runAction(cc.Sequence.actions(cc.DelayTime.actionWithDuration(3),
cc.CallFunc.actionWithTarget(this,this.onGameOver)))},updateUI:function(){this._tmpScore<global.score&&(this._tmpScore+=5);this._lbLife.setString(global.life);this.lbScore.setString("Score: "+this._tmpScore)},checkEnemyAndBulletIsInBound:function(){for(var a=this.getChildren(),b=0;b<a.length;b++){var c=a[b];if(c.getTag()==global.Tag.Enemy||c.getTag()==global.Tag.EnemyBullet||c.getTag()==global.Tag.ShipBullet){var d=c.boundingBoxToWorld();cc.Rect.CCRectIntersectsRect(this.screenRect,d)||this.removeChild(c,
!0)}}},collide:function(a,b){var c=a.collideRect(),d=b.collideRect();if(cc.Rect.CCRectIntersectsRect(c,d))return!0},initBackground:function(){this._backSky=cc.Sprite.spriteWithFile(s_bg01);this._backSky.setAnchorPoint(cc.PointZero());this._backSkyHeight=this._backSky.getContentSize().height;this.addChild(this._backSky,-10);this._backTileMap=cc.TMXTiledMap.tiledMapWithTMXFile(s_level01);this.addChild(this._backTileMap,-9);this._backTileMapHeight=this._backTileMap.getMapSize().height*this._backTileMap.getTileSize().height;
this._backSkyHeight-=48;this._backTileMapHeight-=200;this._backSky.runAction(cc.MoveBy.actionWithDuration(3,new cc.Point(0,-48)));this._backTileMap.runAction(cc.MoveBy.actionWithDuration(3,new cc.Point(0,-200)));this.schedule(this.movingBackground,3)},movingBackground:function(){this._backSky.runAction(cc.MoveBy.actionWithDuration(3,new cc.Point(0,-48)));this._backTileMap.runAction(cc.MoveBy.actionWithDuration(3,new cc.Point(0,-200)));this._backSkyHeight-=48;this._backTileMapHeight-=200;this._backSkyHeight<=
winSize.height&&(this._isBackSkyReload||(this._backSkyRe=cc.Sprite.spriteWithFile(s_bg01),this._backSkyRe.setAnchorPoint(cc.PointZero()),this.addChild(this._backSkyRe,-10),this._backSkyRe.setPosition(new cc.Point(0,winSize.height)),this._isBackSkyReload=!0),this._backSkyRe.runAction(cc.MoveBy.actionWithDuration(3,new cc.Point(0,-48))));0>=this._backSkyHeight&&(this._backSkyHeight=this._backSky.getContentSize().height,this.removeChild(this._backSky),this._backSky=this._backSkyRe,this._backSkyRe=null,
this._isBackSkyReload=!1);this._backTileMapHeight<=winSize.height&&(this._isBackTileReload||(this._backTileMapRe=cc.TMXTiledMap.tiledMapWithTMXFile(s_level01),this.addChild(this._backTileMapRe,-9),this._backTileMapRe.setPosition(new cc.Point(0,winSize.height)),this._isBackTileReload=!0),this._backTileMapRe.runAction(cc.MoveBy.actionWithDuration(3,new cc.Point(0,-200))));0>=this._backTileMapHeight&&(this._backTileMapHeight=this._backTileMapRe.getMapSize().height*this._backTileMapRe.getTileSize().height,
this.removeChild(this._backTileMap),this._backTileMap=this._backTileMapRe,this._backTileMapRe=null,this._isBackTileReload=!1)},onGameOver:function(){var a=cc.Scene.node();a.addChild(GameOver.node());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.transitionWithDuration(1.2,a))}});GameLayer.node=function(){var a=new GameLayer;return a&&a.init()?a:null};GameLayer.scene=function(){var a=cc.Scene.node(),b=GameLayer.node();a.addChild(b,1);return a};var SettingsLayer=cc.Layer.extend({init:function(){var a=!1;if(this._super()){a=cc.Sprite.spriteWithFile(s_loading);a.setAnchorPoint(cc.PointZero());this.addChild(a,0,1);a=cc.TextureCache.sharedTextureCache().addImage(s_menuTitle);a=cc.Sprite.spriteWithTexture(a,cc.RectMake(0,0,134,34));a.setPosition(cc.ccp(winSize.width/2,winSize.height-120));this.addChild(a);cc.MenuItemFont.setFontName("Arial");cc.MenuItemFont.setFontSize(18);var b=cc.MenuItemFont.itemFromString("Sound");b.setIsEnabled(!1);cc.MenuItemFont.setFontName("Arial");
cc.MenuItemFont.setFontSize(26);var c=cc.MenuItemToggle.itemWithTarget(this,this.soundControl,cc.MenuItemFont.itemFromString("On"),cc.MenuItemFont.itemFromString("Off"));cc.MenuItemFont.setFontName("Arial");cc.MenuItemFont.setFontSize(18);var d=cc.MenuItemFont.itemFromString("Mode");d.setIsEnabled(!1);cc.MenuItemFont.setFontName("Arial");cc.MenuItemFont.setFontSize(26);var e=cc.MenuItemToggle.itemWithTarget(this,this.modeControl,cc.MenuItemFont.itemFromString("Easy"),cc.MenuItemFont.itemFromString("Normal"),
cc.MenuItemFont.itemFromString("Hard"));cc.MenuItemFont.setFontName("Arial");cc.MenuItemFont.setFontSize(26);a=cc.LabelTTF.labelWithString("Go back","Arial",20);a=cc.MenuItemLabel.itemWithLabel(a,this,this.backCallback);a.setScale(0.8);b=cc.Menu.menuWithItems(b,d,c,e,a);b.alignItemsInColumns(2,2,1);this.addChild(b);b=a.getPosition();b.y-=50;a.setPosition(b);a=!0}return a},backCallback:function(){var a=cc.Scene.node();a.addChild(SysMenu.node());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.transitionWithDuration(1.2,
a))},soundControl:function(){global.sound=global.sound?!1:!0;global.sound||cc.AudioManager.sharedEngine().end()},modeControl:function(){}});SettingsLayer.node=function(){var a=new SettingsLayer;return a&&a.init()?a:null};var AboutLayer=cc.Layer.extend({init:function(){var a=!1;this._super()&&(a=cc.Sprite.spriteWithFile(s_loading),a.setAnchorPoint(cc.PointZero()),this.addChild(a,0,1),a=cc.TextureCache.sharedTextureCache().addImage(s_menuTitle),a=cc.Sprite.spriteWithTexture(a,cc.RectMake(0,34,100,34)),a.setPosition(cc.ccp(winSize.width/2,winSize.height-120)),this.addChild(a),a=cc.LabelTTF.labelWithString("\n \n This showcase utilizes many features from Cocos2d-html5 engine, including: Parallax background, tilemap, actions, ease, frame animation, schedule, Labels, keyboard Dispatcher, Scene Transition. Art and audio is copyrighted by Enigmata Genus Revenge, you may not use any copyrigted material without permission. This showcase is licensed under GPL",
cc.SizeMake(0.85*winSize.width,100),cc.TextAlignmentLeft,"Arial",14),a.setPosition(cc.ccp(winSize.width/2,winSize.height/2+20)),this.addChild(a),a=cc.LabelTTF.labelWithString("Programmer: \n Shengxiang Chen",cc.SizeMake(0.85*winSize.width,100),cc.TextAlignmentLeft,"Arial",14),a.setPosition(cc.ccp(winSize.width/2,140)),this.addChild(a),a=cc.LabelTTF.labelWithString("Dingping Lv",cc.SizeMake(0.85*winSize.width,100),cc.TextAlignmentCenter,"Arial",14),a.setPosition(cc.ccp(winSize.width/2,120)),this.addChild(a),
a=cc.LabelTTF.labelWithString("Effects animation: \n Hao Wu",cc.SizeMake(0.85*winSize.width,100),cc.TextAlignmentLeft,"Arial",14),a.setPosition(cc.ccp(winSize.width/2,100)),this.addChild(a),a=cc.LabelTTF.labelWithString("Quality Assurance: \n Sean Lin",cc.SizeMake(0.85*winSize.width,80),cc.TextAlignmentLeft,"Arial",14),a.setPosition(cc.ccp(winSize.width/2,80)),this.addChild(a),a=cc.LabelTTF.labelWithString("Go back","Arial",14),a=cc.MenuItemLabel.itemWithLabel(a,this,this.backCallback),a=cc.Menu.menuWithItems(a),
a.setPosition(cc.ccp(winSize.width/2,50)),this.addChild(a),a=!0);return a},backCallback:function(){var a=cc.Scene.node();a.addChild(SysMenu.node());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.transitionWithDuration(1.2,a))}});AboutLayer.node=function(){var a=new AboutLayer;return a&&a.init()?a:null};var GameOver=cc.Layer.extend({_ship:null,_lbScore:0,init:function(){var a=!1;if(this._super){a=cc.Sprite.spriteWithFile(s_loading);a.setAnchorPoint(cc.PointZero());this.addChild(a,0,1);a=cc.Sprite.spriteWithFile(s_gameOver);a.setAnchorPoint(cc.ccp(0,0));a.setPosition(cc.ccp(0,300));this.addChild(a,10,1);var a=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(378,0,126,33)),b=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(378,33,126,33)),c=cc.Sprite.spriteWithFile(s_menu,cc.RectMake(378,66,126,33)),d=cc.Sprite.spriteWithFile(s_cocos2dhtml5);
d.setPosition(cc.ccp(160,150));this.addChild(d,10);a=cc.MenuItemSprite.itemFromNormalSprite(a,b,c,this,function(){flareEffect(this,this,this.onPlayAgain)});a=cc.Menu.menuWithItems(a);this.addChild(a,1,2);a.setPosition(cc.ccp(winSize.width/2,220));a=cc.LabelTTF.labelWithString("Your Score:"+global.score,"Arial Bold",16);a.setPosition(cc.ccp(160,280));a.setColor(cc.ccc3(250,179,0));this.addChild(a,10);b=cc.LabelTTF.labelWithString("Download Cocos2d-html5","Arial",14);a=cc.LabelTTF.labelWithString("Download This Sample",
"Arial",14);b=cc.MenuItemLabel.itemWithLabel(b,this,function(){window.location.href="http://www.cocos2d-x.org/projects/cocos2d-x/wiki/Cocos2d-html5"});a=cc.MenuItemLabel.itemWithLabel(a,this,function(){window.location.href="https://github.com/ShengxiangChen/MoonWarriors"});a=cc.Menu.menuWithItems(b,a);a.alignItemsVerticallyWithPadding(10);a.setPosition(cc.ccp(160,80));this.addChild(a);this.schedule(this.update,0.1);global.sound&&cc.AudioManager.sharedEngine().playBackgroundMusic(s_mainMainMusic);
a=!0}return a},onPlayAgain:function(){global.score=0;global.life=4;var a=cc.Scene.node();a.addChild(GameLayer.node());a.addChild(GameControlMenu.node());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.transitionWithDuration(1.2,a))}});GameOver.node=function(){var a=new GameOver;return a&&a.init()?a:null};GameOver.scene=function(){var a=cc.Scene.node(),b=GameOver.node();a.addChild(b);return a};